{% extends "layout.html" %} 
{% block title %}
<title>Manage Packages</title>
{% endblock %} 
{% block styles %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
{% endblock %} 
{% block content %}
<div class="container mt-4">
  <!-- Flash Messages -->
  <div>
    {% with messages = get_flashed_messages(with_categories=true) %} 
    {% if messages %} 
    {% for category, msg in messages %}
    <p class="alert alert-{{ category }}">{{ msg }}</p>
    {% endfor %} 
    {% endif %} 
    {% endwith %}
  </div>

  <!-- Package Data Section -->
  <h1 class="mb-4" style="color: white">Manage Packages</h1>

  <!-- Button Section -->
  <div class="d-flex mb-3">
    <a
      href="{{ url_for('admindashboard') }}"
      class="btn btn-primary me-2 user-action-btn"
    >
      Back to Dashboard
    </a>
    <a
      href="{{ url_for('addpackage') }}"
      class="btn btn-primary user-action-btn"
    >
      Add New Package
    </a>
  </div>

  {% if packages %}
  <div class="table-responsive" style="overflow-x: auto">
    <table class="table table-bordered table-striped">
      <thead class="thead-dark">
        <tr>
          <th>Package ID</th>
          <th>Package Name</th>
          <th>Description</th>
          <th>Price</th>
          <th>Group Size</th> <!-- New Column -->
          <th>Photo</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for package in packages %}
        <tr>
          <td>{{ package['packagesid'] }}</td>
          <td>{{ package['packagename'] }}</td>
          <td
            style="max-width: 250px; word-wrap: break-word; overflow-wrap: break-word; white-space: normal;"
          >
            {{ package['description'] }}
          </td>
          <td>${{ package['price'] }}</td>
          <td>{{ package['group_size'] }}</td> <!-- Display Group Size -->
          <td>
            {% if package['photo'] %}
            <img
              src="{{ url_for('static', filename='photos/' + package['photo']) }}"
              alt="Package Photo"
              style="width: 50px; height: 50px; object-fit: cover"
            />
            {% else %}
            No image available
            {% endif %}
          </td>
          <td>
            <!-- Edit Package Button -->
            <a
              href="{{ url_for('editpackages', packagesid=package['packagesid']) }}"
              class="btn btn-primary btn-sm user-action-btn"
            >
              <i class="fas fa-edit"></i><span class="d-inline"> Edit</span>
            </a>

            <!-- Delete Package Form -->
            <form
              action="{{ url_for('delete_package', packagesid=package['packagesid']) }}"
              method="post"
              style="display: inline"
            >
              <button
                type="submit"
                class="btn btn-danger btn-sm user-action-btn"
                onclick="return confirm('Are you sure you want to delete this package type?');"
              >
                <i class="fas fa-trash"></i
                ><span class="d-inline"> Delete</span>
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination Section -->
  <div class="pagination mt-4">
    {% if total_pages > 1 %}
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <!-- Previous Page Link -->
        {% if current_page > 1 %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('viewpackages', page=current_page - 1) }}"
            aria-label="Previous"
          >
            <span aria-hidden="true">&laquo; Previous</span>
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <a class="page-link" href="#" tabindex="-1" aria-disabled="true"
            >&laquo; Previous</a
          >
        </li>
        {% endif %}

        <!-- Page Links -->
        {% for page in page_range %}
        <li class="page-item {% if page == current_page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('viewpackages', page=page) }}"
            >{{ page }}</a
          >
        </li>
        {% endfor %}

        <!-- Next Page Link -->
        {% if current_page < total_pages %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('viewpackages', page=current_page + 1) }}"
            aria-label="Next"
          >
            <span aria-hidden="true">Next &raquo;</span>
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <a class="page-link" href="#" tabindex="-1" aria-disabled="true"
            >Next &raquo;</a
          >
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>

  {% else %}
  <p class="text-white">No packages found.</p>
  {% endif %}
</div>

<!-- Inline CSS for Consistent Button Design -->
<style>
  .user-action-btn {
    border-radius: 5px;
    padding: 7px 20px;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
  }

  .user-action-btn i {
    font-size: 18px;
    margin-right: 8px;
  }

  .user-action-btn span {
    font-size: 14px;
  }

  @media (max-width: 768px) {
    .user-action-btn {
      padding: 5px 12px !important;
    }
    .user-action-btn i {
      font-size: 14px !important;
    }
    .user-action-btn span {
      font-size: 12px !important;
    }
  }

  @media (max-width: 576px) {
    .user-action-btn {
      padding: 4px 10px !important;
    }
    .user-action-btn i {
      font-size: 12px !important;
    }
    .user-action-btn span {
      font-size: 10px !important;
    }
  }

  .table-responsive {
    overflow-x: auto;
  }
</style>

{% endblock %}
