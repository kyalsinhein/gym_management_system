{% extends "layout.html" %} 
{% block title %} Manage Users {% endblock %} 
{% block styles %}
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  rel="stylesheet"
/>
{% endblock %} 
{% block content %}
<div class="container mt-4">
  <!-- Flash Messages -->
  <div>
    {% with messages = get_flashed_messages(with_categories=true) %} 
    {% if messages %} 
    {% for category, msg in messages %}
    <p class="alert alert-{{ category }}">{{ msg }}</p>
    {% endfor %} 
    {% endif %} 
    {% endwith %}
  </div>

  <!-- User Data Section -->
  <h1 class="mb-4" style="color: white">Manage Users</h1>
  <a
    href="{{ url_for('admindashboard') }}"
    class="btn btn-primary mt-3 user-action-btn"
    >Back to Dashboard</a
  >
  <a
    href="{{ url_for('adduser') }}"
    class="btn btn-primary mt-3 user-action-btn"
    >Add New User</a
  >
  <br /><br />

  {% if users %}
  <!-- Responsive Table Wrapper -->
  <div class="table-responsive" style="overflow-x: auto">
    <table class="table table-bordered table-striped">
      <thead class="thead-dark">
        <tr>
          <th style="width: 100px">User ID</th>
          <th style="width: 150px">User Name</th>
          <th style="width: 200px">User Email</th>
          <th style="width: 150px">User Password</th>
          <th style="width: 180px">Registration Date</th>
          <th style="width: 180px">Security Key</th>
          <th style="width: 150px">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user['userid'] }}</td>
          <td>{{ user['username'] }}</td>
          <td>{{ user['useremail'] }}</td>
          <td>{{ user['userpassword'] }}</td>
          <td>{{ user['registration_date'] or 'N/A' }}</td>
          <td>{{ user['security_key'] or 'N/A' }}</td>
          <td>
            <!-- Button Group for Profile, Edit, and Delete -->
            <div style="display: flex; gap: 10px">
              <!-- Profile Button -->
            <!-- Edit Button -->
              <a
                href="{{ url_for('edituser', userid=user['userid']) }}"
                class="btn btn-primary btn-sm user-action-btn"
              >
                <i
                  class="fas fa-edit"
                  style="font-size: 18px; margin-right: 8px"
                ></i
                ><span> Edit</span>
              </a>

              <!-- Delete Button -->
              <form
                action="{{ url_for('deleteuser', userid=user['userid']) }}"
                method="post"
                style="display: inline"
              >
                <button
                  type="submit"
                  class="btn btn-danger btn-sm user-action-btn"
                  onclick="return confirm('Are you sure you want to delete this user?');"
                >
                  <i
                    class="fas fa-trash"
                    style="font-size: 18px; margin-right: 8px"
                  ></i
                  ><span> Delete</span>
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="pagination mt-4">
    {% if total_pages > 1 %}
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <!-- Previous Page -->
        <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
          <a
            class="page-link"
            href="{{ url_for('viewusers', page=current_page - 1) }}"
            aria-label="Previous"
          >
            <span aria-hidden="true">&laquo; Previous</span>
          </a>
        </li>

        <!-- Page Range -->
        {% for page_num in page_range %}
        <li
          class="page-item {% if page_num == current_page %}active{% endif %}"
        >
          <a class="page-link" href="{{ url_for('viewusers', page=page_num) }}">
            {{ page_num }}
          </a>
        </li>
        {% endfor %}

        <!-- Next Page -->
        <li
          class="page-item {% if current_page == total_pages %}disabled{% endif %}"
        >
          <a
            class="page-link"
            href="{{ url_for('viewusers', page=current_page + 1) }}"
            aria-label="Next"
          >
            <span aria-hidden="true">Next &raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
    {% endif %}
  </div>

  {% else %}
  <p class="text-white">No users found.</p>
  {% endif %}
</div>

<!-- Inline CSS for Consistent Button Design -->
<style>
  /* Static button design */
  .user-action-btn {
    border-radius: 5px;
    padding: 7px 20px;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
  }

  /* Ensure icons and buttons are consistent across all screen sizes */
  .user-action-btn i {
    font-size: 18px;
    margin-right: 8px;
  }

  .user-action-btn span {
    font-size: 14px;
  }

  /* Make buttons look consistent even on small screens */
  @media (max-width: 768px) {
    .user-action-btn {
      padding: 7px 20px; /* Maintain padding */
      font-size: 14px; /* Maintain font size */
    }
    .user-action-btn i {
      font-size: 18px; /* Icon size remains the same */
    }
    .user-action-btn span {
      font-size: 14px; /* Text size remains the same */
    }
  }
</style>

{% endblock %}
